#!/bin/bash

set -e
bin=$(dirname $0)

rootPackage=github.com/cloudfoundry/bosh-init

$bin/go install code.google.com/p/gomock/mockgen

srcFiles=(
  config/LegacyDeploymentStateMigrator
  cloud/Cloud,Factory
	installation/Installation,Installer,InstallerFactory
	installation/state/Builder
	installation/pkg/Installer
	installation/job/Installer
	deployment/Deployment,Factory,Deployer,Manager,ManagerFactory
	deployment/agentclient/AgentClient
	deployment/agentclient/http/AgentClientFactory
	deployment/instance/Instance,Manager
	deployment/instance/state/BuilderFactory,Builder,State
	deployment/disk/Disk,Manager
	deployment/vm/ManagerFactory
	deployment/release/JobResolver
  registry/Server,ServerManager
  release/Manager,Extractor
  release/set/Resolver
  state/job/DependencyCompiler
  state/pkg/Compiler,CompiledPackageRepo
	stemcell/CloudStemcell,Manager
  templatescompiler/JobRenderer,JobListRenderer,RenderedJob,RenderedJobList,RenderedJobListArchive,RenderedJobListCompressor
  blobstore/Factory,Blobstore
)

for srcFile in ${srcFiles[*]}; do
  package=`dirname $srcFile`
  class=`basename $srcFile`

  srcDir=`dirname $srcFile`
  srcFilename=`basename $srcFile`
  destFile=$srcDir/mocks/mocks.go

  mkdir -p $srcDir/mocks
  echo $bin/env mockgen -package mocks -destination $destFile $rootPackage/$package $class
  $bin/env mockgen -package mocks -destination $destFile $rootPackage/$package $class
  $bin/go fmt $destFile
done
